<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>(^^) Socket.IO chat</title>

	<!-- normalize.css -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">

	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; }

		#messages {
			list-style: none;
			margin: 0;
			padding: 0;
		}
		#messages > li {
			white-space: pre-wrap;
			padding: 16px;
		}
		#messages > li:nth-child(odd) { background: whitesmoke; }

		#input-message {
			resize: none;
			border: solid black 8px;
			padding: 8px;
			max-width: 100%;
			width: 100%;
		}

		form {
			position: fixed;
			bottom: 0;
			width: 100%;
		}
	</style>
</head>
<body>
	<ul id="messages"></ul>

	<form>
		<textarea id="input-message" placeholder="按 Enter 送出訊息。按 Shift+Enter 換行。"></textarea>
	</form>

	<!-- Socket.IO -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.slim.js"></script>
	<!-- jQuery -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<script>
		$(function() {
			let $messages = $("#messages");
			let $form = $("form");
			let $inputMessage = $("#input-message");

			// https://stackoverflow.com/a/36413924/6378871
			$inputMessage.keypress(function(e) {
				if (e.which === 13 && !e.shiftKey) {
					$(this).closest("form").submit();
					e.preventDefault();
					return false;
				}
			});

			let socket = io();
			$form.submit(function() {
				socket.emit("chat message", $inputMessage.val());
				$inputMessage.val("");
				return false;
			});
			socket.on("chat message", function(msg) {
				$messages.append($("<li>").text(msg));
				window.scrollTo(0, document.body.scrollHeight);
			});

			$messages.css("margin-bottom", `${$form.height()}px`);
		});
	</script>
</body>
</html>
